"use strict";(self.webpackChunkmcp_docs=self.webpackChunkmcp_docs||[]).push([[4986],{8004:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"deployment/docker","title":"Docker: Deploying HAPI MCP Servers","description":"How to deploy and run HAPI MCP servers using Docker for local development, cloud deployment, and air-gapped environments.","source":"@site/docs/8-deployment/docker.md","sourceDirName":"8-deployment","slug":"/deployment/docker","permalink":"/deployment/docker","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Docker","title":"Docker: Deploying HAPI MCP Servers","description":"How to deploy and run HAPI MCP servers using Docker for local development, cloud deployment, and air-gapped environments.","keywords":["Docker","MCP","OpenAPI","API-first","Model Context Protocol","Container","HAPI"],"author":"La Rebelion Labs","publisher":"MCP Project","dateModified":"2025-01-05"},"sidebar":"tutorialSidebar","previous":{"title":"Deployment Guide","permalink":"/deployment/"},"next":{"title":"Cloudflare Deployment","permalink":"/deployment/cloud/cloudflare/"}}');var r=i(4848),o=i(8453);const l={sidebar_position:2,sidebar_label:"Docker",title:"Docker: Deploying HAPI MCP Servers",description:"How to deploy and run HAPI MCP servers using Docker for local development, cloud deployment, and air-gapped environments.",keywords:["Docker","MCP","OpenAPI","API-first","Model Context Protocol","Container","HAPI"],author:"La Rebelion Labs",publisher:"MCP Project",dateModified:"2025-01-05"},a="Docker: Deploying HAPI MCP Servers",c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Start: Run Locally",id:"quick-start-run-locally",level:2},{value:"Basic Example",id:"basic-example",level:3},{value:"With Environment Variables",id:"with-environment-variables",level:3},{value:"Advanced Usage: Custom OpenAPI Specs",id:"advanced-usage-custom-openapi-specs",level:2},{value:"List Available Specs",id:"list-available-specs",level:3},{value:"Help Command",id:"help-command",level:3},{value:"Container Management",id:"container-management",level:2},{value:"View Logs",id:"view-logs",level:3},{value:"Stop a Container",id:"stop-a-container",level:3},{value:"Remove a Container Manually",id:"remove-a-container-manually",level:3},{value:"Air-Gapped / Offline Deployments",id:"air-gapped--offline-deployments",level:2},{value:"Save Image Locally",id:"save-image-locally",level:3},{value:"Load on Air-Gapped Machine",id:"load-on-air-gapped-machine",level:3},{value:"Run in Air-Gapped Environment",id:"run-in-air-gapped-environment",level:3},{value:"Docker Compose Example",id:"docker-compose-example",level:2},{value:"Run with Compose",id:"run-with-compose",level:3},{value:"View Logs",id:"view-logs-1",level:3},{value:"Stop",id:"stop",level:3},{value:"Cloud Deployment with Docker",id:"cloud-deployment-with-docker",level:2},{value:"Build and Push to Docker Registry",id:"build-and-push-to-docker-registry",level:3},{value:"Deploy to Cloudflare Workers with Docker",id:"deploy-to-cloudflare-workers-with-docker",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Container Exits Immediately",id:"container-exits-immediately",level:3},{value:"Port Already in Use",id:"port-already-in-use",level:3},{value:"Permission Denied on Volume Mount",id:"permission-denied-on-volume-mount",level:3},{value:"References",id:"references",level:2}];function t(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"docker-deploying-hapi-mcp-servers",children:"Docker: Deploying HAPI MCP Servers"})}),"\n",(0,r.jsx)(n.p,{children:"This guide covers how to deploy and run HAPI MCP servers using Docker for local development, cloud deployments, and air-gapped environments."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker"})," installed on your machine"]}),"\n",(0,r.jsxs)(n.li,{children:["Access to the HAPI MCP CLI image (",(0,r.jsx)(n.code,{children:"hapimcp/hapi-cli"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"An OpenAPI specification for your API"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start-run-locally",children:"Quick Start: Run Locally"}),"\n",(0,r.jsxs)(n.p,{children:["The fastest way to start an HAPI MCP server locally is using ",(0,r.jsx)(n.code,{children:"docker run"})," with volume mounts for configuration and specs."]}),"\n",(0,r.jsx)(n.h3,{id:"basic-example",children:"Basic Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker run --name hapi-petstore -d --rm \\\n  -p 3030:3030 \\\n  -v ~/.hapi:/app/.hapi \\\n  hapimcp/hapi-cli:latest serve petstore \\\n  --port 3030 \\\n  --headless\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What this does:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--name hapi-petstore"}),": Names the container for easy reference."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-d"}),": Runs the container in detached mode (background)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--rm"}),": Automatically removes the container when it stops."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-p 3030:3030"}),": Exposes port 3030 from the container to your host."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-v ~/.hapi:/app/.hapi"}),": Mounts your local HAPI home directory for persistence."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"serve petstore"}),": Runs the petstore example (built-in demo)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--port 3030"}),": Sets the server port inside the container."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--headless"}),": Act as a ",(0,r.jsx)(n.strong,{children:"headless-API (HAPI) server"}),", the business logic runs in the server defined by the OpenAPI spec."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"with-environment-variables",children:"With Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"For more control, pass environment variables:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'docker run --name hapi-petstore -d --rm \\\n  -p 3030:3030 \\\n  -v ~/.hapi:/app/.hapi \\\n  -e HAPI_HOME=/app/.hapi \\\n  hapimcp/hapi-cli:0.6.0 serve petstore \\\n  --port 3030 \\\n  --headless \\\n  --dev \\\n  --url "https://petstore3.swagger.io/api/v3"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key environment variables:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HAPI_HOME"}),": Path to HAPI configuration directory inside the container."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"url"}),": Backend API URL for headless mode. Overrides the default in the OpenAPI spec."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dev"}),": Enables development mode with verbose logging."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"advanced-usage-custom-openapi-specs",children:"Advanced Usage: Custom OpenAPI Specs"}),"\n",(0,r.jsx)(n.p,{children:"If you have multiple OpenAPI specs in a local directory, mount them into the container:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker run --name hapi-custom -d --rm \\\n  -p 3030:3030 \\\n  -v ~/.hapi:/app/.hapi \\\n  -v ~/my-specs:/app/.hapi/specs \\\n  hapimcp/hapi-cli:latest serve my-api-openapi \\\n  --port 3030 \\\n  --headless\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The parameter ",(0,r.jsx)(n.code,{children:"my-api-openapi"})," corresponds to the filename (without extension) of your OpenAPI spec located in ",(0,r.jsx)(n.code,{children:"~/my-specs"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"list-available-specs",children:"List Available Specs"}),"\n",(0,r.jsx)(n.p,{children:"View all mounted specs without starting a server:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker run --rm \\\n  -v ~/.hapi:/app/.hapi \\\n  hapimcp/hapi-cli:latest list\n"})}),"\n",(0,r.jsx)(n.p,{children:"This outputs all available OpenAPI specs and configurations."}),"\n",(0,r.jsx)(n.h3,{id:"help-command",children:"Help Command"}),"\n",(0,r.jsx)(n.p,{children:"Get help on commands and options:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker run --rm hapimcp/hapi-cli:latest help\n"})}),"\n",(0,r.jsx)(n.h2,{id:"container-management",children:"Container Management"}),"\n",(0,r.jsx)(n.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker logs hapi-petstore\n"})}),"\n",(0,r.jsx)(n.p,{children:"For real-time logs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker logs -f hapi-petstore\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stop-a-container",children:"Stop a Container"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker stop hapi-petstore\n"})}),"\n",(0,r.jsx)(n.h3,{id:"remove-a-container-manually",children:"Remove a Container Manually"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker rm hapi-petstore\n"})}),"\n",(0,r.jsx)(n.h2,{id:"air-gapped--offline-deployments",children:"Air-Gapped / Offline Deployments"}),"\n",(0,r.jsx)(n.p,{children:"For environments without internet access, pre-pull the image and load it:"}),"\n",(0,r.jsx)(n.h3,{id:"save-image-locally",children:"Save Image Locally"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker pull hapimcp/hapi-cli:latest\ndocker save hapimcp/hapi-cli:latest -o hapi-cli-latest.tar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"load-on-air-gapped-machine",children:"Load on Air-Gapped Machine"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker load -i hapi-cli-latest.tar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"run-in-air-gapped-environment",children:"Run in Air-Gapped Environment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:'docker run --name hapi-offline -d --rm \\\n  -p 3030:3030 \\\n  -v ~/.hapi:/app/.hapi \\\n  hapimcp/hapi-cli:latest serve petstore \\\n  --port 3030 \\\n  --headless \\\n  --url "https://petstore3.air-gapped.local/api/v3"\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"To access external APIs, ensure your air-gapped environment has the necessary network configurations."})}),"\n",(0,r.jsx)(n.h2,{id:"docker-compose-example",children:"Docker Compose Example"}),"\n",(0,r.jsx)(n.p,{children:"For more complex setups, use Docker Compose:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  hapi-mcp:\n    image: hapimcp/hapi-cli:latest\n    container_name: hapi-mcp-server\n    ports:\n      - "3030:3030"\n    environment:\n      - NODE_ENV=development\n      - HAPI_HOME=/app/.hapi\n    volumes:\n      - ~/.hapi:/app/.hapi\n      - ./more-specs:/app/.hapi/specs\n    command: serve petstore --port 3030 --headless --dev\n    restart: unless-stopped\n  # Add more services as needed, i.e., a CRM, database, etc.\n  my-crm-mcp:\n    image: hapimcp/hapi-cli:latest\n    container_name: my-crm-mcp-server\n    ports:\n      - "4040:3030"\n    environment:\n      - NODE_ENV=production\n      - HAPI_HOME=/app/.hapi\n    volumes:\n      - ~/.hapi:/app/.hapi\n      - ./crm-specs:/app/.hapi/specs\n    command: serve crm-api --port 3030 --headless\n    restart: unless-stopped\n'})}),"\n",(0,r.jsx)(n.h3,{id:"run-with-compose",children:"Run with Compose"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker-compose up -d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"view-logs-1",children:"View Logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker-compose logs -f hapi-mcp\n"})}),"\n",(0,r.jsx)(n.h3,{id:"stop",children:"Stop"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker-compose down\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cloud-deployment-with-docker",children:"Cloud Deployment with Docker"}),"\n",(0,r.jsx)(n.h3,{id:"build-and-push-to-docker-registry",children:"Build and Push to Docker Registry"}),"\n",(0,r.jsx)(n.p,{children:"If you customize the HAPI MCP CLI container instance, save and push it to your Docker registry:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker save hapimcp/hapi-cli:latest -o hapi-cli-1.0.0.tar\n# in your air-gapped or cloud environment\ndocker load -i hapi-cli-1.0.0.tar\ndocker push your-registry/hapi-cli:1.0.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"deploy-to-cloudflare-workers-with-docker",children:"Deploy to Cloudflare Workers with Docker"}),"\n",(0,r.jsx)(n.p,{children:"For serverless deployment, use the Docker image with Cloudflare Workers:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ensure the image is accessible"})," from your build environment."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Use the ",(0,r.jsx)(n.code,{children:"hapi deploy"})," command"]})," (which internally uses Wrangler) to deploy:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"hapi deploy --openapi https://my-api.example.com/openapi.json \\\n  --url https://my-api.example.com \\\n  --name my-hapi-worker\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For more details, see the Cloudflare Workers Deployment guide and the HAPI MCP CLI documentation for ",(0,r.jsx)(n.a,{href:"./cloud/cloudflare",children:"Cloudflare deployment"})," options."]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use explicit version tags:"})," Always specify a version (e.g., ",(0,r.jsx)(n.code,{children:"0.6.0"}),") instead of latest ",(0,r.jsx)(n.strong,{children:"for production"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mount HAPI home:"})," Keep configuration persistent with ",(0,r.jsx)(n.code,{children:"-v ~/.hapi:/app/.hapi"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resource limits:"})," Use ",(0,r.jsx)(n.code,{children:"--memory"})," and ",(0,r.jsx)(n.code,{children:"--cpus"})," to limit container resources."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Health checks:"})," Add health checks for production deployments. The MCP server exposes a ",(0,r.jsx)(n.code,{children:"/health"})," endpoint, also, you can use the ",(0,r.jsxs)(n.a,{href:"https://modelcontextprotocol.io/specification/2025-11-25/basic/utilities/ping",children:[(0,r.jsx)(n.code,{children:"ping"})," MCP utility"]}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Logging:"})," Monitor logs regularly and use log aggregation tools for large deployments."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Security:"})," Run as non-root, use read-only mounts where possible, and scan images for vulnerabilities."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"container-exits-immediately",children:"Container Exits Immediately"}),"\n",(0,r.jsx)(n.p,{children:"Check logs:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker logs hapi-petstore\n"})}),"\n",(0,r.jsx)(n.h3,{id:"port-already-in-use",children:"Port Already in Use"}),"\n",(0,r.jsx)(n.p,{children:"Change the host port:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"docker run -p 3031:3030 ... # Maps host 3031 to container 3030\n"})}),"\n",(0,r.jsx)(n.h3,{id:"permission-denied-on-volume-mount",children:"Permission Denied on Volume Mount"}),"\n",(0,r.jsx)(n.p,{children:"Ensure the mounted directory has correct permissions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"chmod 755 ~/.hapi\n"})}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.docker.com/",children:"Docker Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.mcp.com.ai",children:"HAPI MCP CLI Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://swagger.io/specification/",children:"OpenAPI Specification"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://developers.cloudflare.com/workers/",children:"Cloudflare Workers"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var s=i(6540);const r={},o=s.createContext(r);function l(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);